#
# smakefile for xprzmodem.library
#

ZMODEM_PATH    = 68020+_1x/
MAKEFILE       = smakefile.020+
ZMODEM_LIBRARY = xprzmodem.library
PROZESSOR      = 68020
NAME_AND_DATE  = "ZModem 3.1 68020+ (03.10.93)"
ASMOPT         = -m2
VER            = 3
REV            = 1

#CFLAGS	 = NMINC STRMERGE OPTIMIZE OPTTIME PARMS=REG \
#	   NOSTKCHK LIBCODE CPU=$(PROZESSOR)         \
#	   DEFINE=DEBUGLOG # DEFINE=DEBUGLEVEL2

CFLAGS	 = NMINC STRMERGE OPTIMIZE OPTTIME PARMS=REG \
           NOSTKCHK LIBCODE CPU=$(PROZESSOR)

OBJS	 = xprzmodem_locale.o Send.o Receive.o Utils.o Zm.o GetSysTime.o xprsprintf.o
CHECK	 = xprzmodem_catalog.h xprzmodem_catalog.cd \
	   Xproto.h Zmodem.h XprZmodem.h $(MAKEFILE)

NOCOMPACT=IDIR=CH:  # <= Path to uncompacted Header-Files

$(ZMODEM_LIBRARY): xprzmodem.GST $(OBJS)

              @SLINK FROM LIB:libent.o LIB:libinit.o $(OBJS)         \
              to $@ LIBPREFIX _ LIBFD Xpr_Lib.FD VERBOSE             \
              LIBID $(NAME_AND_DATE) LIB LIB:sc.Lib SC SD ND NOICONS \
              LIBVERSION $(VER) LIBREVISION $(REV) MAP $(ZMODEM_PATH)$@.Map FHL
              copy $(ZMODEM_LIBRARY) $(ZMODEM_PATH)

Send.o:       Send.c $(CHECK)
              @SC $(CFLAGS) GST=xprzmodem.GST Send.c

Receive.o:    Receive.c $(CHECK)
              @SC $(CFLAGS) GST=xprzmodem.GST Receive.c

Utils.o:      Utils.c $(CHECK)
              @SC $(CFLAGS) GST=xprzmodem.GST Utils.c

Zm.o:         Zm.c Zcrc.h $(CHECK)
              @SC $(CFLAGS) GST=xprzmodem.GST Zm.c

GetSysTime.o: GetSysTime.c
              @SC $(CFLAGS) GST=xprzmodem.GST GetSysTime.c

xprsprintf.o: xprsprintf.a
              ASM $(ASMOPT) xprsprintf.a

xprzmodem_locale.o: xprzmodem_locale.c xprzmodem_catalog.h
                    SC $(CFLAGS) xprzmodem_locale.c


xprzmodem_catalog.h: xprzmodem_catalog.cd
                     CatComp xprzmodem_catalog.cd CFILE xprzmodem_catalog.h

# Make xprzmodem_catalog?.ct Catalog with
# "CatComp xprzmodem_catalog.cd CTFILE xprzmodem_catalog?.ct"

# 1. CatComp xprzmodem_catalog.cd CTFILE xprzmodem_catalog?.ct
# 2. Edit xprzmodem_catalog?.ct
# 3. Make a Catalog:
#    "CatComp xprzmodem_catalog.cd xprzmodem_catalog?.ct CATALOG catalogs/language/xprzmodem.catalog"


#
# GST-File
#

xprzmodem.GST: xprzmodem_all.h $(CHECK)
               @SC $(CFLAGS) $(NOCOMACT) NOOBJNAME \
                  MAKEGST=xprzmodem.GST xprzmodem_all.h
